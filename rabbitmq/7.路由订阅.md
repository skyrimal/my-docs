# 路由使用

直连 direct 才会关联路由，关联后只会获取同路由的数据

## 1.channel初始化

```java
channel.exchangeDeclare(RabbitMqManage.EXCHANGE_ROUTE, BuiltinExchangeType.DIRECT);
```

## 2.发送消息

> basicPublish调用时需要指明交换机和路由，当有路由后，接收消息必须按照路由进行接收消息

```java
String routingKey = "testRoute";
String routingKey2 = "testRoute2";
manage.sendMessage(channel,RabbitMqManage.EXCHANGE_ROUTE,"测试路由功能"+routingKey,routingKey);
manage.sendMessage(channel,RabbitMqManage.EXCHANGE_ROUTE,"测试路由功能"+routingKey2,routingKey2);
```

## 3.接收消息

接收一个路由就将队列绑定时添加路由

```java
String routingKey = "testRoute";
channel.queueBind(queue,RabbitMqManage.EXCHANGE_ROUTE,routingKey);
```

想绑定多个路由，则需要将队列绑定多次，

实际上第一次将队列与交换机、第一个路由绑定，第二次只是与第二个路由绑定

```java
String routingKey = "testRoute";
String routingKey2 = "testRoute2";
channel.queueBind(queue,RabbitMqManage.EXCHANGE_ROUTE,routingKey);
channel.queueBind(queue,RabbitMqManage.EXCHANGE_ROUTE,routingKey2);

channel.basicConsume(queue,new DefaultConsumer(channel){
    @Override
    public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException {
        System.out.println(new String(body,"utf-8"));
    }
});
```